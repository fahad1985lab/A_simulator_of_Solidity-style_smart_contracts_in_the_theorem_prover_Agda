<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>libraries.IOlibrary</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="constantparameters.html" class="Module">constantparameters</a>

<a id="33" class="Keyword">module</a> <a id="40" href="libraries.IOlibrary.html" class="Module">libraries.IOlibrary</a> <a id="60" class="Keyword">where</a>

<a id="67" class="Keyword">open</a> <a id="72" class="Keyword">import</a> <a id="79" href="Data.Nat.html" class="Module">Data.Nat</a>
<a id="88" class="Keyword">open</a> <a id="93" class="Keyword">import</a> <a id="100" href="Data.List.html" class="Module">Data.List</a> <a id="110" class="Keyword">hiding</a> <a id="117" class="Symbol">(</a><a id="118" href="Data.List.Base.html#1810" class="Function Operator">_++_</a><a id="122" class="Symbol">)</a>
<a id="124" class="Keyword">open</a> <a id="129" class="Keyword">import</a> <a id="136" href="Agda.Builtin.Nat.html" class="Module">Agda.Builtin.Nat</a> <a id="153" class="Keyword">using</a> <a id="159" class="Symbol">(</a><a id="160" href="Agda.Builtin.Nat.html#415" class="Primitive Operator">_-_</a><a id="163" class="Symbol">;</a> <a id="165" href="Agda.Builtin.Nat.html#528" class="Primitive Operator">_*_</a><a id="168" class="Symbol">)</a>
<a id="170" class="Keyword">open</a> <a id="175" class="Keyword">import</a> <a id="182" href="Data.Unit.html" class="Module">Data.Unit</a>
<a id="192" class="Keyword">open</a> <a id="197" class="Keyword">import</a> <a id="204" href="Data.Bool.html" class="Module">Data.Bool</a>
<a id="214" class="Keyword">open</a> <a id="219" class="Keyword">import</a> <a id="226" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a>
<a id="241" class="Keyword">open</a> <a id="246" class="Keyword">import</a> <a id="253" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a>
<a id="267" class="Keyword">open</a> <a id="272" class="Keyword">import</a> <a id="279" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="290" class="Keyword">hiding</a> <a id="297" class="Symbol">(</a><a id="298" href="Data.Maybe.Base.html#2227" class="Function Operator">_&gt;&gt;=_</a><a id="303" class="Symbol">)</a>
<a id="305" class="Keyword">open</a> <a id="310" class="Keyword">import</a> <a id="317" href="Data.String.html" class="Module">Data.String</a> <a id="329" class="Keyword">hiding</a> <a id="336" class="Symbol">(</a><a id="337" href="Data.String.Base.html#2430" class="Function">length</a><a id="343" class="Symbol">;</a><a id="344" href="Data.String.Base.html#1561" class="Primitive">show</a><a id="348" class="Symbol">)</a>
<a id="350" class="Keyword">open</a> <a id="355" class="Keyword">import</a> <a id="362" href="Data.Nat.Show.html" class="Module">Data.Nat.Show</a>
<a id="376" class="Keyword">open</a> <a id="381" class="Keyword">import</a> <a id="388" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="404" class="Symbol">as</a> <a id="407" class="Module">Maybe</a> <a id="413" class="Keyword">using</a> <a id="419" class="Symbol">(</a><a id="420" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a><a id="425" class="Symbol">;</a> <a id="427" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a><a id="434" class="Symbol">;</a> <a id="436" href="Data.Maybe.Base.html#2335" class="Function Operator">_&lt;∣&gt;_</a><a id="441" class="Symbol">;</a> <a id="443" href="Data.Maybe.Base.html#2450" class="Function">when</a><a id="447" class="Symbol">)</a>
<a id="449" class="Keyword">import</a> <a id="456" href="Data.Maybe.Categorical.html" class="Module">Data.Maybe.Categorical</a> <a id="479" class="Symbol">as</a> <a id="482" class="Module">Maybe</a>
<a id="488" class="Keyword">open</a> <a id="493" class="Keyword">import</a> <a id="500" href="Data.Product.html" class="Module">Data.Product</a> <a id="513" class="Keyword">renaming</a> <a id="522" class="Symbol">(</a><a id="523" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a> <a id="527" class="Symbol">to</a> <a id="530" class="InductiveConstructor Operator">_,,_</a> <a id="535" class="Symbol">)</a>
<a id="537" class="Keyword">open</a> <a id="542" class="Keyword">import</a> <a id="549" href="Agda.Builtin.String.html" class="Module">Agda.Builtin.String</a>

<a id="570" class="Comment">--our work</a>
<a id="581" class="Keyword">open</a> <a id="586" class="Keyword">import</a> <a id="593" href="libraries.natCompare.html" class="Module">libraries.natCompare</a>
<a id="614" class="Keyword">open</a> <a id="619" class="Keyword">import</a> <a id="626" href="libraries.Mainlibrary.html" class="Module">libraries.Mainlibrary</a>
<a id="648" class="Keyword">open</a> <a id="653" class="Keyword">import</a> <a id="660" href="interface.ConsoleLib.html" class="Module">interface.ConsoleLib</a>
<a id="681" class="Keyword">open</a> <a id="686" class="Keyword">import</a> <a id="693" href="Complex-Model.ccomand.ccommands-cresponse.html" class="Module">Complex-Model.ccomand.ccommands-cresponse</a>
<a id="735" class="Keyword">open</a> <a id="740" class="Keyword">import</a> <a id="747" href="basicDataStructure.html" class="Module">basicDataStructure</a>



<a id="string2FunctionName"></a><a id="769" href="libraries.IOlibrary.html#769" class="Function">string2FunctionName</a> <a id="789" class="Symbol">:</a> <a id="791" href="Agda.Builtin.String.html#336" class="Postulate">String</a> <a id="798" class="Symbol">→</a> <a id="800" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="806" href="basicDataStructure.html#190" class="Function">FunctionName</a>
<a id="819" href="libraries.IOlibrary.html#769" class="Function">string2FunctionName</a> <a id="839" href="libraries.IOlibrary.html#839" class="Bound">str</a> <a id="843" class="Symbol">=</a> <a id="845" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="850" href="libraries.IOlibrary.html#839" class="Bound">str</a>




<a id="funname2string"></a><a id="858" href="libraries.IOlibrary.html#858" class="Function">funname2string</a> <a id="873" class="Symbol">:</a> <a id="875" href="basicDataStructure.html#190" class="Function">FunctionName</a> <a id="888" class="Symbol">→</a> <a id="890" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="897" href="libraries.IOlibrary.html#858" class="Function">funname2string</a> <a id="912" href="libraries.IOlibrary.html#912" class="Bound">x</a> <a id="914" class="Symbol">=</a> <a id="916" href="libraries.IOlibrary.html#912" class="Bound">x</a>



<a id="921" class="Keyword">mutual</a>
  <a id="msgList2String"></a><a id="930" href="libraries.IOlibrary.html#930" class="Function">msgList2String</a> <a id="945" class="Symbol">:</a> <a id="947" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="952" href="basicDataStructure.html#523" class="Datatype">Msg</a> <a id="956" class="Symbol">→</a> <a id="958" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
  <a id="967" href="libraries.IOlibrary.html#930" class="Function">msgList2String</a> <a id="982" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="985" class="Symbol">=</a> <a id="987" class="String">&quot;&quot;</a>
  <a id="992" href="libraries.IOlibrary.html#930" class="Function">msgList2String</a> <a id="1007" class="Symbol">(</a><a id="1008" href="libraries.IOlibrary.html#1008" class="Bound">msg</a> <a id="1012" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1014" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="1016" class="Symbol">)</a> <a id="1018" class="Symbol">=</a> <a id="1020" href="libraries.IOlibrary.html#1119" class="Function">msg2string</a> <a id="1031" href="libraries.IOlibrary.html#1008" class="Bound">msg</a>
  <a id="1037" href="libraries.IOlibrary.html#930" class="CatchallClause Function">msgList2String</a><a id="1051" class="CatchallClause"> </a><a id="1052" class="CatchallClause Symbol">(</a><a id="1053" href="libraries.IOlibrary.html#1053" class="CatchallClause Bound">msg</a><a id="1056" class="CatchallClause"> </a><a id="1057" href="Agda.Builtin.List.html#200" class="CatchallClause InductiveConstructor Operator">∷</a><a id="1058" class="CatchallClause"> </a><a id="1059" href="libraries.IOlibrary.html#1059" class="CatchallClause Bound">rest</a><a id="1063" class="CatchallClause Symbol">)</a> <a id="1065" class="Symbol">=</a> <a id="1067" href="libraries.IOlibrary.html#1119" class="Function">msg2string</a> <a id="1078" href="libraries.IOlibrary.html#1053" class="Bound">msg</a>  <a id="1083" href="Data.String.Base.html#2366" class="Function Operator">++</a> <a id="1086" class="String">&quot; , &quot;</a> <a id="1092" href="Data.String.Base.html#2366" class="Function Operator">++</a> <a id="1095" href="libraries.IOlibrary.html#930" class="Function">msgList2String</a> <a id="1110" href="libraries.IOlibrary.html#1059" class="Bound">rest</a>


  <a id="msg2string"></a><a id="1119" href="libraries.IOlibrary.html#1119" class="Function">msg2string</a> <a id="1130" class="Symbol">:</a> <a id="1132" href="basicDataStructure.html#523" class="Datatype">Msg</a> <a id="1136" class="Symbol">→</a> <a id="1138" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
  <a id="1147" href="libraries.IOlibrary.html#1119" class="Function">msg2string</a> <a id="1158" class="Symbol">(</a><a id="1159" href="basicDataStructure.html#542" class="InductiveConstructor">nat</a> <a id="1163" href="libraries.IOlibrary.html#1163" class="Bound">n</a><a id="1164" class="Symbol">)</a>         <a id="1174" class="Symbol">=</a> <a id="1176" class="String">&quot;(nat &quot;</a> <a id="1184" href="Data.String.Base.html#2366" class="Function Operator">++</a> <a id="1187" href="Data.Nat.Show.html#1928" class="Function">show</a> <a id="1192" href="libraries.IOlibrary.html#1163" class="Bound">n</a> <a id="1194" href="Data.String.Base.html#2366" class="Function Operator">++</a> <a id="1197" class="String">&quot;)&quot;</a>
  <a id="1203" href="libraries.IOlibrary.html#1119" class="Function">msg2string</a> <a id="1214" class="Symbol">(</a><a id="1215" href="libraries.IOlibrary.html#1215" class="Bound">msg</a> <a id="1219" href="basicDataStructure.html#578" class="InductiveConstructor Operator">+msg</a> <a id="1224" href="libraries.IOlibrary.html#1224" class="Bound">msg₁</a><a id="1228" class="Symbol">)</a> <a id="1230" class="Symbol">=</a>  <a id="1233" class="String">&quot;(&quot;</a> <a id="1237" href="Data.String.Base.html#2366" class="Function Operator">++</a> <a id="1240" href="libraries.IOlibrary.html#1119" class="Function">msg2string</a> <a id="1251" href="libraries.IOlibrary.html#1215" class="Bound">msg</a> <a id="1255" href="Data.String.Base.html#2366" class="Function Operator">++</a> <a id="1258" class="String">&quot; , &quot;</a> <a id="1264" href="Data.String.Base.html#2366" class="Function Operator">++</a> <a id="1267" href="libraries.IOlibrary.html#1119" class="Function">msg2string</a> <a id="1278" href="libraries.IOlibrary.html#1224" class="Bound">msg₁</a> <a id="1283" href="Data.String.Base.html#2366" class="Function Operator">++</a> <a id="1286" class="String">&quot;)&quot;</a>
  <a id="1292" href="libraries.IOlibrary.html#1119" class="Function">msg2string</a> <a id="1303" class="Symbol">(</a><a id="1304" href="basicDataStructure.html#615" class="InductiveConstructor">list</a> <a id="1309" href="libraries.IOlibrary.html#1309" class="Bound">l</a><a id="1310" class="Symbol">)</a>        <a id="1319" class="Symbol">=</a> <a id="1321" class="String">&quot;[&quot;</a> <a id="1325" href="Data.String.Base.html#2366" class="Function Operator">++</a> <a id="1328" href="libraries.IOlibrary.html#930" class="Function">msgList2String</a> <a id="1343" href="libraries.IOlibrary.html#1309" class="Bound">l</a> <a id="1345" href="Data.String.Base.html#2366" class="Function Operator">++</a> <a id="1348" class="String">&quot;]&quot;</a>


<a id="1354" class="Comment">-- Test cases</a>
<a id="1368" class="Comment">-- msg2string (nat 5)</a>
<a id="1390" class="Comment">--    &quot;(nat 5)&quot;&quot;(nat 5)&quot;</a>
<a id="1415" class="Comment">-- msg2string (list ((nat 3)  ∷ (nat 7) ∷ []))</a>
<a id="1462" class="Comment">--    &quot;[(nat 3) , (nat 7) ]&quot;</a>
<a id="1491" class="Comment">-- msg2string (list ((nat 3)  ∷ ((nat 7) +msg (nat 8) ) ∷ []))</a>
<a id="1554" class="Comment">--    &quot;[(nat 3) , ((nat 7) , (nat 8))]&quot;</a>

<a id="1595" class="Comment">--Error to String</a>
<a id="error2Str"></a><a id="1613" href="libraries.IOlibrary.html#1613" class="Function">error2Str</a> <a id="1623" class="Symbol">:</a> <a id="1625" href="basicDataStructure.html#671" class="Datatype">ErrorMsg</a> <a id="1634" class="Symbol">→</a> <a id="1636" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="1643" href="libraries.IOlibrary.html#1613" class="Function">error2Str</a> <a id="1653" class="Symbol">(</a><a id="1654" href="basicDataStructure.html#694" class="InductiveConstructor">strErr</a> <a id="1661" href="libraries.IOlibrary.html#1661" class="Bound">s</a><a id="1662" class="Symbol">)</a>  <a id="1665" class="Symbol">=</a> <a id="1667" href="libraries.IOlibrary.html#1661" class="Bound">s</a>
<a id="1669" href="libraries.IOlibrary.html#1613" class="Function">error2Str</a> <a id="1679" class="Symbol">(</a><a id="1680" href="basicDataStructure.html#726" class="InductiveConstructor">numErr</a> <a id="1687" href="libraries.IOlibrary.html#1687" class="Bound">n</a><a id="1688" class="Symbol">)</a>  <a id="1691" class="Symbol">=</a> <a id="1693" class="String">&quot;Number error (&quot;</a> <a id="1710" href="Data.String.Base.html#2366" class="Function Operator">++</a> <a id="1713" href="Data.Nat.Show.html#1928" class="Function">show</a> <a id="1718" href="libraries.IOlibrary.html#1687" class="Bound">n</a>  <a id="1721" href="Data.String.Base.html#2366" class="Function Operator">++</a> <a id="1724" class="String">&quot;)&quot;</a> 
<a id="1729" href="libraries.IOlibrary.html#1613" class="Function">error2Str</a> <a id="1739" href="basicDataStructure.html#753" class="InductiveConstructor">undefined</a> <a id="1749" class="Symbol">=</a> <a id="1751" class="String">&quot;Error undefined&quot;</a>
<a id="1769" href="libraries.IOlibrary.html#1613" class="Function">error2Str</a> <a id="1779" href="basicDataStructure.html#776" class="InductiveConstructor">outOfGasError</a> <a id="1793" class="Symbol">=</a> <a id="1795" class="String">&quot;Out of gas error&quot;</a>

<a id="1815" class="Comment">--ErrorMsg to String</a>
<a id="errorMsg2Str"></a><a id="1836" href="libraries.IOlibrary.html#1836" class="Function">errorMsg2Str</a> <a id="1849" class="Symbol">:</a> <a id="1851" href="basicDataStructure.html#1074" class="Datatype">NatOrError</a> <a id="1862" class="Symbol">→</a> <a id="1864" href="Agda.Builtin.String.html#336" class="Postulate">String</a>
<a id="1871" href="libraries.IOlibrary.html#1836" class="Function">errorMsg2Str</a> <a id="1884" class="Symbol">(</a><a id="1885" href="basicDataStructure.html#1098" class="InductiveConstructor">nat</a> <a id="1889" href="libraries.IOlibrary.html#1889" class="Bound">n</a><a id="1890" class="Symbol">)</a> <a id="1892" class="Symbol">=</a> <a id="1894" href="Data.Nat.Show.html#1928" class="Function">show</a> <a id="1899" href="libraries.IOlibrary.html#1889" class="Bound">n</a>
<a id="1901" href="libraries.IOlibrary.html#1836" class="Function">errorMsg2Str</a> <a id="1914" class="Symbol">(</a><a id="1915" href="basicDataStructure.html#1120" class="InductiveConstructor">err</a> <a id="1919" href="libraries.IOlibrary.html#1919" class="Bound">e</a> <a id="1921" href="basicDataStructure.html#881" class="InductiveConstructor Operator">⟨</a> <a id="1923" href="libraries.IOlibrary.html#1923" class="Bound">lastcalladdr</a> <a id="1936" href="basicDataStructure.html#881" class="InductiveConstructor Operator">&gt;&gt;</a> <a id="1939" href="libraries.IOlibrary.html#1939" class="Bound">curraddr</a> <a id="1948" href="basicDataStructure.html#881" class="InductiveConstructor Operator">∙</a> <a id="1950" href="libraries.IOlibrary.html#1950" class="Bound">lastfunname</a> <a id="1962" href="basicDataStructure.html#881" class="InductiveConstructor Operator">[</a> <a id="1964" href="libraries.IOlibrary.html#1964" class="Bound">lastmsg</a> <a id="1972" href="basicDataStructure.html#881" class="InductiveConstructor Operator">]⟩</a><a id="1974" class="Symbol">)</a> <a id="1976" class="Symbol">=</a> <a id="1978" href="libraries.IOlibrary.html#1613" class="Function">error2Str</a> <a id="1988" href="libraries.IOlibrary.html#1919" class="Bound">e</a>
<a id="1990" href="libraries.IOlibrary.html#1836" class="Function">errorMsg2Str</a> <a id="2003" href="basicDataStructure.html#1161" class="InductiveConstructor">invalidtransaction</a> <a id="2022" class="Symbol">=</a> <a id="2024" class="String">&quot;invalidtransaction&quot;</a>


<a id="checkamount"></a><a id="2047" href="libraries.IOlibrary.html#2047" class="Function">checkamount</a> <a id="2059" class="Symbol">:</a> <a id="2061" href="libraries.Mainlibrary.html#1075" class="Function">Ledger</a> <a id="2068" class="Symbol">→</a> <a id="2070" href="basicDataStructure.html#405" class="Function">Address</a> <a id="2078" class="Symbol">→</a> <a id="2080" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
<a id="2082" href="libraries.IOlibrary.html#2047" class="Function">checkamount</a> <a id="2094" href="libraries.IOlibrary.html#2094" class="Bound">ledger</a> <a id="2101" href="libraries.IOlibrary.html#2101" class="Bound">addr</a> <a id="2106" class="Symbol">=</a> <a id="2108" href="libraries.IOlibrary.html#2094" class="Bound">ledger</a> <a id="2115" href="libraries.IOlibrary.html#2101" class="Bound">addr</a> <a id="2120" class="Symbol">.</a><a id="2121" href="libraries.Mainlibrary.html#839" class="Field">amount</a>




<a id="2132" class="Comment">-- define state for IO</a>
<a id="2155" class="Keyword">record</a> <a id="StateIO"></a><a id="2162" href="libraries.IOlibrary.html#2162" class="Record">StateIO</a>  <a id="2171" class="Symbol">:</a> <a id="2173" href="Agda.Primitive.html#326" class="Primitive">Set</a>  <a id="2178" class="Keyword">where</a>
       <a id="2191" class="Keyword">constructor</a> <a id="⟨_ledger,_initialAddr,_gas⟩"></a><a id="2203" href="libraries.IOlibrary.html#2203" class="InductiveConstructor Operator">⟨_ledger,_initialAddr,_gas⟩</a>
       <a id="2238" class="Keyword">field</a>
        <a id="StateIO.ledger"></a><a id="2252" href="libraries.IOlibrary.html#2252" class="Field">ledger</a>       <a id="2265" class="Symbol">:</a> <a id="2267" href="libraries.Mainlibrary.html#1075" class="Function">Ledger</a>
        <a id="StateIO.initialAddr"></a><a id="2282" href="libraries.IOlibrary.html#2282" class="Field">initialAddr</a>  <a id="2295" class="Symbol">:</a> <a id="2297" href="basicDataStructure.html#405" class="Function">Address</a>
        <a id="StateIO.gas"></a><a id="2313" href="libraries.IOlibrary.html#2313" class="Field">gas</a>          <a id="2326" class="Symbol">:</a> <a id="2328" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
<a id="2330" class="Keyword">open</a> <a id="2335" href="libraries.IOlibrary.html#2162" class="Module">StateIO</a> <a id="2343" class="Keyword">public</a>




</pre></body></html>